<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" crossorigin="anonymous" />
    <title>Profile - PinPoint</title>
  </head>
  <body>
    <nav class="navbar sticky-top navbar-expand-lg navbar-dark bg-dark">
      <a class="navbar-brand" href="../index.html">PinPoint</a>
    </nav>

    <main class="container py-5">
      <h2>Complete your profile</h2>
      <div class="card p-4">
        <div class="form-group">
          <label>Email</label>
          <input id="email" type="email" class="form-control" disabled />
        </div>
        <div class="form-group">
          <label>Your Name</label>
          <input id="name" type="text" class="form-control" placeholder="John Doe" />
        </div>
        <button id="saveBtn" class="btn btn-primary">Save & Continue</button>
      </div>
    </main>

    <script type="module">
      import { Api } from '../assets/js/api.js';
      import { requireAuthOrRedirect } from '../assets/js/auth.js';

      let current;
      async function load() {
        current = await requireAuthOrRedirect();
        if (!current) return;
        document.getElementById('email').value = current.email || '';
        document.getElementById('name').value = current.name || '';
      }

      document.getElementById('saveBtn').addEventListener('click', async () => {
        const name = document.getElementById('name').value.trim();
        if (!name) return alert('Please enter your name');
        const updated = await Api.updateMe({ name });
        if (updated && !updated.error) {
          if (!updated.campusId) window.location.href = './campus-select.html';
          else window.location.href = '../index.html';
        } else {
          alert(updated?.error?.message || 'Failed to save');
        }
      });

      load();
    </script>
  </body>
</html>
